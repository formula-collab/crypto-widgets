<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Fear & Greed</title>
  <style>
    :root {
      --bg: transparent;
      --card: rgba(255,255,255,0.95);
      --text: #111;
      --muted: #555;
      --border: rgba(0,0,0,0.08);
    }

    html, body { margin: 0; padding: 0; background: var(--bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; }

    .wrap { width: 100%; padding: 12px; box-sizing: border-box; }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 14px 12px 14px;
      box-sizing: border-box;
    }

    .top {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .updated {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .scoreBox {
      min-width: 78px;
      text-align: center;
      padding: 10px 10px;
      border-radius: 12px;
      color: #fff;
      font-weight: 800;
      line-height: 1.05;
    }

    .score {
      font-size: 26px;
      letter-spacing: -0.5px;
    }

    .label {
      font-size: 12px;
      opacity: 0.95;
      margin-top: 4px;
    }

    .barWrap {
      flex: 1;
      min-width: 0;
    }

    .bar {
      position: relative;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      background: linear-gradient(90deg,
        #c0392b 0%,
        #e67e22 25%,
        #f1c40f 50%,
        #2ecc71 75%,
        #16a085 100%
      );
    }

    .dot {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #111;
      border: 2px solid #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.18);
    }

    .scale {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    .hint {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .err {
      margin-top: 10px;
      font-size: 12px;
      color: #b00020;
      line-height: 1.45;
    }

    .small {
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    a { color: inherit; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="title">암호화폐 공포·탐욕 지수</div>
        <div class="updated" id="updated">불러오는 중…</div>
      </div>

      <div class="row">
        <div class="scoreBox" id="scoreBox" style="background:#777;">
          <div class="score" id="score">--</div>
          <div class="label" id="label">Loading</div>
        </div>

        <div class="barWrap">
          <div class="bar">
            <div class="dot" id="dot" style="left: 0%;"></div>
          </div>
          <div class="scale">
            <span>0 (공포)</span>
            <span>50 (중립)</span>
            <span>100 (탐욕)</span>
          </div>
          <div class="small">색은 분위기, 점은 현재 위치(0~100)</div>
        </div>
      </div>

      <div class="hint" id="hint">
        히트맵처럼 “한눈에 분위기 확인”용입니다. 단독 매매 신호로 쓰기보다는 시장 심리 체크에 활용하세요.
      </div>

      <div class="err" id="err" style="display:none;"></div>
    </div>
  </div>

  <script>
    const API = "https://api.alternative.me/fng/?limit=1&format=json";

    function toKoreanClass(score) {
      // Alternative.me classification 예: Extreme Fear / Fear / Neutral / Greed / Extreme Greed
      if (!score && score !== 0) return "알 수 없음";
      if (score <= 24) return "극도의 공포";
      if (score <= 44) return "공포";
      if (score <= 55) return "중립";
      if (score <= 74) return "탐욕";
      return "극도의 탐욕";
    }

    function colorByScore(score) {
      if (score <= 24) return "#c0392b";
      if (score <= 44) return "#e67e22";
      if (score <= 55) return "#f1c40f";
      if (score <= 74) return "#2ecc71";
      return "#16a085";
    }

    function safeDateText(unixTs) {
      // API는 보통 unix timestamp(초) 제공
      try {
        const d = new Date(Number(unixTs) * 1000);
        if (isNaN(d.getTime())) return "";
        // 한국어 간단 표기
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
      } catch {
        return "";
      }
    }

    async function loadFNG() {
      const updatedEl = document.getElementById("updated");
      const scoreEl = document.getElementById("score");
      const labelEl = document.getElementById("label");
      const dotEl = document.getElementById("dot");
      const scoreBoxEl = document.getElementById("scoreBox");
      const errEl = document.getElementById("err");

      try {
        errEl.style.display = "none";
        updatedEl.textContent = "불러오는 중…";

        const res = await fetch(API, { cache: "no-store" });
        if (!res.ok) throw new Error(`API 응답 오류: ${res.status}`);

        const json = await res.json();
        const item = json?.data?.[0];
        const score = Number(item?.value);

        if (!isFinite(score)) throw new Error("지수 값을 읽지 못했습니다.");

        const label = toKoreanClass(score);
        const color = colorByScore(score);

        scoreEl.textContent = String(score);
        labelEl.textContent = label;
        scoreBoxEl.style.background = color;

        // 0~100 → 0%~100%
        const pct = Math.max(0, Math.min(100, score));
        dotEl.style.left = `${pct}%`;

        const tsText = safeDateText(item?.timestamp);
        updatedEl.textContent = tsText ? `업데이트: ${tsText}` : "업데이트: 확인됨";
      } catch (e) {
        errEl.style.display = "block";
        errEl.textContent = `불러오지 못했습니다. (원인: ${e?.message || e})`;
        updatedEl.textContent = "업데이트: 실패";
      }
    }

    loadFNG();
    // 10분마다 갱신 (원하면 변경 가능)
    setInterval(loadFNG, 10 * 60 * 1000);
  </script>
</body>
</html>
