<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Fear & Greed</title>
  <style>
    html, body { margin:0; padding:0; background:#fff; }
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif; }

    /* ✅ 세로 크게: 여기 숫자만 더 키우면 됨 */
    .wrap { width:100%; min-height:360px; padding:28px 32px; box-sizing:border-box; }

    .top { display:flex; justify-content:space-between; align-items:center; margin-bottom:18px; }
    .title { font-size:20px; font-weight:900; }
    .updated { font-size:12px; color:#666; }

    .row { display:flex; gap:26px; align-items:flex-start; }
    .scoreBox {
      width:120px; height:120px; border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      font-size:40px; font-weight:900; color:#fff; background:#616161;
    }
    .scoreLabel { margin-top:10px; font-size:14px; font-weight:800; text-align:center; color:#111; }

    .barWrap { flex:1; }
    .bar {
      position:relative;
      /* ✅ 바 높이(= y축 느낌) */
      height:28px;
      border-radius:14px;
      background: linear-gradient(to right,#d32f2f,#f57c00,#fbc02d,#4caf50);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
    }
    .indicator {
      position:absolute; top:-10px;
      width:16px; height:48px;
      background:#111; border-radius:8px;
      transform:translateX(-50%);
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
    }
    .scale { display:flex; justify-content:space-between; font-size:12px; color:#666; margin-top:12px; }
    .desc { margin-top:16px; font-size:14px; color:#444; line-height:1.6; }
    .hint { margin-top:10px; font-size:12px; color:#888; }
    .err { color:#b71c1c; font-weight:800; }
  </style>
</head>
<body>
  <!-- ✅ JS가 실패해도 이 박스는 무조건 렌더링됨 -->
  <div class="wrap">
    <div class="top">
      <div class="title">암호화폐 공포·탐욕 지수</div>
      <div class="updated" id="updated">업데이트: 로딩 중…</div>
    </div>

    <div class="row">
      <div>
        <div class="scoreBox" id="scoreBox">--</div>
        <div class="scoreLabel" id="scoreLabel">로딩 중</div>
      </div>

      <div class="barWrap">
        <div class="bar">
          <div class="indicator" id="indicator" style="left:50%;"></div>
        </div>
        <div class="scale">
          <span>0 (공포)</span>
          <span>50 (중립)</span>
          <span>100 (탐욕)</span>
        </div>

        <div class="desc" id="desc">데이터를 불러오는 중입니다…</div>
        <div class="hint" id="hint">만약 로딩이 계속되면 Ctrl+F5로 강력 새로고침 해보세요.</div>
      </div>
    </div>
  </div>

  <script>
    function labelFrom(v){
      if (v <= 25) return "극도의 공포";
      if (v <= 45) return "공포";
      if (v <= 55) return "중립";
      if (v <= 75) return "탐욕";
      return "극도의 탐욕";
    }
    function colorFrom(v){
      if (v <= 25) return "#c62828";
      if (v <= 45) return "#ef6c00";
      if (v <= 55) return "#f9a825";
      if (v <= 75) return "#43a047";
      return "#2e7d32";
    }
    function fmt(ts){
      const d = new Date(ts);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      return `${y}-${m}-${day} ${hh}:${mm}`;
    }
    function setUI(v, tsText){
      const vv = Math.max(0, Math.min(100, Number(v)));
      document.getElementById("scoreBox").textContent = vv;
      document.getElementById("scoreBox").style.background = colorFrom(vv);
      document.getElementById("scoreLabel").textContent = labelFrom(vv);
      document.getElementById("indicator").style.left = vv + "%";
      document.getElementById("updated").textContent = "업데이트: " + tsText;
      document.getElementById("desc").textContent =
        `현재 지수는 ${vv}이며, 시장 심리가 ‘${labelFrom(vv)}’ 구간에 가깝다는 뜻입니다.`;
      document.getElementById("hint").textContent = "데이터 출처: alternative.me 공개 API";
    }

    (async function(){
      const url = "https://api.alternative.me/fng/?limit=1&format=json";
      try{
        const res = await fetch(url, { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const json = await res.json();
        const item = json?.data?.[0];
        const value = item?.value;
        const ts = item?.timestamp ? Number(item.timestamp) * 1000 : Date.now();
        setUI(value, fmt(ts));
      } catch(e){
        // ✅ 실패해도 흰 화면 X: 실패 메시지 보여주기
        document.getElementById("updated").textContent = "업데이트: 실패";
        document.getElementById("scoreLabel").textContent = "불러오기 실패";
        document.getElementById("desc").innerHTML =
          `<span class="err">데이터 로딩 실패</span>: 네트워크/차단(CORS)일 수 있습니다.`;
        document.getElementById("hint").textContent =
          "브라우저 시크릿창 또는 Ctrl+F5로 재시도. (이후에도 안 되면 F12 콘솔 확인)";
        console.error(e);
      }
    })();
  </script>
</body>
</html>
